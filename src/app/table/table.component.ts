import { Component, OnInit } from '@angular/core';

@Component({
  selector: 'app-table',
  templateUrl: './table.component.html',
  styleUrls: ['./table.component.css']
})
export class TableComponent implements OnInit {

  GuardRegMessagesList = [
    {
      RegulationName: 'ABC1',
      GuardRegMessageDetailList: [
        {
          GuardRegMessageCategory: 'ABC11',
          GuardRegMessageList: [
            {
              GuardMessageText: 'ABC111',
              GuardRegMessageToolTipText: 'fsdagfhjgdsak',
              GuradMessageColor: 'fdgsajhfkd',
              RegActionToBeTaken: [
                {
                  PrefixMessage: 'ABC1111',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1112',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                }
              ]
            },
            {
              GuardMessageText: 'ABC112',
              GuardRegMessageToolTipText: 'fsdagfhjgdsak',
              GuradMessageColor: 'fdgsajhfkd',
              RegActionToBeTaken: [
                {
                  PrefixMessage: 'ABC1121',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1122',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                }
              ]
            },
          ]
        },
        {
          GuardRegMessageCategory: 'ABC12',
          GuardRegMessageList: [
            {
              GuardMessageText: 'ABC121',
              GuardRegMessageToolTipText: 'fsdagfhjgdsak',
              GuradMessageColor: 'fdgsajhfkd',
              RegActionToBeTaken: [
                {
                  PrefixMessage: 'ABC1211',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1212',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                }
              ]
            },
            {
              GuardMessageText: 'ABC122',
              GuardRegMessageToolTipText: 'fsdagfhjgdsak',
              GuradMessageColor: 'fdgsajhfkd',
              RegActionToBeTaken: [
                {
                  PrefixMessage: 'ABC1221',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1222',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                }
              ]
            },
          ]
        },
      ]
    },
    {
      RegulationName: 'ABC1',
      GuardRegMessageDetailList: [
        {
          GuardRegMessageCategory: 'ABC11',
          GuardRegMessageList: [
            {
              GuardMessageText: 'ABC111',
              GuardRegMessageToolTipText: 'fsdagfhjgdsak',
              GuradMessageColor: 'fdgsajhfkd',
              RegActionToBeTaken: [
                {
                  PrefixMessage: 'ABC1111',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1112',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                }
              ]
            },
            {
              GuardMessageText: 'ABC112',
              GuardRegMessageToolTipText: 'fsdagfhjgdsak',
              GuradMessageColor: 'fdgsajhfkd',
              RegActionToBeTaken: [
                {
                  PrefixMessage: 'ABC1121',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1122',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                }
              ]
            },
          ]
        },
        {
          GuardRegMessageCategory: 'ABC12',
          GuardRegMessageList: [
            {
              GuardMessageText: 'ABC121',
              GuardRegMessageToolTipText: 'fsdagfhjgdsak',
              GuradMessageColor: 'fdgsajhfkd',
              RegActionToBeTaken: [
                {
                  PrefixMessage: 'ABC1211',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1212',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                }
              ]
            },
            {
              GuardMessageText: 'ABC122',
              GuardRegMessageToolTipText: 'fsdagfhjgdsak',
              GuradMessageColor: 'fdgsajhfkd',
              RegActionToBeTaken: [
                {
                  PrefixMessage: 'ABC1221',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1222',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                }
              ]
            },
          ]
        },
      ]
    },
    {
      RegulationName: 'ABC1',
      GuardRegMessageDetailList: [
        {
          GuardRegMessageCategory: 'ABC11',
          GuardRegMessageList: [
            {
              GuardMessageText: 'ABC111',
              GuardRegMessageToolTipText: 'fsdagfhjgdsak',
              GuradMessageColor: 'fdgsajhfkd',
              RegActionToBeTaken: [
                {
                  PrefixMessage: 'ABC1111',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1112',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                }
              ]
            },
            {
              GuardMessageText: 'ABC112',
              GuardRegMessageToolTipText: 'fsdagfhjgdsak',
              GuradMessageColor: 'fdgsajhfkd',
              RegActionToBeTaken: [
                {
                  PrefixMessage: 'ABC1121',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1122',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1122',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                }
              ]
            },
          ]
        },
        {
          GuardRegMessageCategory: 'ABC12',
          GuardRegMessageList: [
            {
              GuardMessageText: 'ABC121',
              GuardRegMessageToolTipText: 'fsdagfhjgdsak',
              GuradMessageColor: 'fdgsajhfkd',
              RegActionToBeTaken: [
                {
                  PrefixMessage: 'ABC1211',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1212',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                }
              ]
            },
            {
              GuardMessageText: 'ABC122',
              GuardRegMessageToolTipText: 'fsdagfhjgdsak',
              GuradMessageColor: 'fdgsajhfkd',
              RegActionToBeTaken: [
                {
                  PrefixMessage: 'ABC1221',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                },
                {
                  PrefixMessage: 'ABC1222',
                  LinDisplayText: 'fgdshajfk',
                  Link: 'fdsakf',
                  SuffixMessage: 'dsfaads'
                }
              ]
            },
          ]
        },
      ]
    },
  ]


  RegularList = [
    {
      RegulationName : 'ABC1',
      GuardRegMessageCategory : 'ABC11',
      GuardMessageText : 'ABC111',
      PrefixMessage : 'ABC1111'
  },
  {
      RegulationName : 'ABC1',
      GuardRegMessageCategory : 'ABC11',
      GuardMessageText : 'ABC111',
      PrefixMessage : 'ABC1112' 
  },
  {
      RegulationName : 'ABC1',
      GuardRegMessageCategory : 'ABC11',
      GuardMessageText : 'ABC112',
      PrefixMessage : 'ABC1111' 
  },
  {
      RegulationName : 'ABC1',
      GuardRegMessageCategory : 'ABC11',
      GuardMessageText : 'ABC112',
      PrefixMessage : 'ABC1112' 
  },
  
  {
      RegulationName : 'ABC1',
      GuardRegMessageCategory : 'ABC12',
      GuardMessageText : 'ABC111',
      PrefixMessage : 'ABC1111' 
  },
  {
      RegulationName : 'ABC1',
      GuardRegMessageCategory : 'ABC12',
      GuardMessageText : 'ABC111',
      PrefixMessage : 'ABC1112' 
  },
  {
      RegulationName : 'ABC1',
      GuardRegMessageCategory : 'ABC12',
      GuardMessageText : 'ABC112',
      PrefixMessage : 'ABC1111' 
  },
  {
      RegulationName : 'ABC1',
      GuardRegMessageCategory : 'ABC12',
      GuardMessageText : 'ABC112',
      PrefixMessage : 'ABC1112' 
  },
  
  ]

  constructor() { }

  formList = []


  ngOnInit() {
    console.log(this.GuardRegMessagesList)
    this.formList = this.myFunction(this.GuardRegMessagesList)
    console.log(this.formList)
  }

  unwindArray(arr, f) {
    return arr.reduce((r, o) => r.concat(o[f].map(v => ({ ...o, [f]: v }))), []);
  }


  myFunction(GuardRegMessagesList) {
    let preLevel = GuardRegMessagesList.map(x => {
      x['firstLevel'] = this.countLeafNodeFirstLevel(x)
      return x
    })
   let firstLevel = this.unwindArray(preLevel, 'GuardRegMessageDetailList')
   firstLevel = firstLevel.map(x => {
     return {
      RegulationName : x.RegulationName,
      GuardRegMessageCategory : x.GuardRegMessageDetailList.GuardRegMessageCategory,
      GuardRegMessageList : x.GuardRegMessageDetailList.GuardRegMessageList,
      firstLevel : x.firstLevel,
      secondLevel : this.countLeafNodeSecondLevel(x.GuardRegMessageDetailList)
     }
   })
   
   let secondLevel = this.unwindArray(firstLevel, 'GuardRegMessageList') 
   secondLevel = secondLevel.map(x => {
    return {
     RegulationName : x.RegulationName,
     GuardRegMessageCategory : x.GuardRegMessageCategory,
     GuardRegMessageList : x.GuardRegMessageList,
     firstLevel : x.firstLevel,
     secondLevel : + x.secondLevel,
     GuardMessageText : x.GuardRegMessageList.GuardMessageText,
     GuardRegMessageToolTipText : x.GuardRegMessageList.GuardRegMessageToolTipText,
     GuradMessageColor : x.GuardRegMessageList.GuradMessageColor,
     RegActionToBeTaken : x.GuardRegMessageList.RegActionToBeTaken,
     thirdLevel : this.countLeafNodeThirdLevel(x.GuardRegMessageList)
    }
  })
  let thirdLevel = this.unwindArray(secondLevel, 'RegActionToBeTaken') 
  return this.updateRowSpan(thirdLevel)
  
  
  }

  updateRowSpan(guardMessageArray) {
    //FirstColumn
    let length = guardMessageArray.length
    let i = 0
    while(i < length) {
      guardMessageArray[i]['firstColumn'] = true
      i = i + guardMessageArray[i]['firstLevel']
    }

    //Second Column
    i = 0
    while(i < length) {
      guardMessageArray[i]['secondColumn'] = true
      i = i + guardMessageArray[i]['secondLevel']
    }

    //Third Column
    i = 0
    while(i < length) {
      guardMessageArray[i]['thirdColumn'] = true
      i = i + guardMessageArray[i]['thirdLevel']
    }
    return guardMessageArray
  }

  countLeafNodeFirstLevel(obj) {
    let count =0
    for(let i = 0; i<obj.GuardRegMessageDetailList.length;i++) {
      for(let j=0;j<obj.GuardRegMessageDetailList[i].GuardRegMessageList.length;j++) {
        for(let k=0;k<obj.GuardRegMessageDetailList[i].GuardRegMessageList[j].RegActionToBeTaken.length;k++) {
          count = count +1
        }
      }
    }
    return count
  }

  countLeafNodeSecondLevel(obj) {
    let count =0
    for(let j=0;j<obj.GuardRegMessageList.length;j++) {
      for(let k=0;k<obj.GuardRegMessageList[j].RegActionToBeTaken.length;k++) {
        count = count +1
      }
    }
    return count
  }

  countLeafNodeThirdLevel(obj) {
    let count =0
    
    for(let k=0;k<obj.RegActionToBeTaken.length;k++) {
      count = count +1
    }
    
    return count
  }

}


